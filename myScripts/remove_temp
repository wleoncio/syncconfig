#!/bin/bash
# Error codes:
# 0 - success
# 1 - missing required argument (not used, docopts handles it)
# 2 - missing dependencies
version="0.1.0 licensed under GPLv3"

usage() {
  cat << EOU
Usage:
  $(basename $0) <file_path>
  $(basename $0) -h | --help
  $(basename $0) --version

Lists and removes all lines ending with '# TEMP' from the specified file.

Arguments:
  <file_path>  Path to the file to process

Options:
  -h --help    Print this help and exit
  --version    Print version and exit

Send bug reports and feature requests to: https://github.com/wleoncio/syncconfig/issues
EOU
}

# Check if docopts is installed
if ! command -v docopts &> /dev/null; then
  echo "Error: docopts is not installed." >&2
  exit 2
fi

# Parse arguments
eval "$(docopts -A ARGS -h "$(usage)" -V "$version" : "$@")"
file="${ARGS['<file_path>']}"

if [ ! -f "$file" ]; then
  echo "File not found: $file"
  exit 1
fi


echo "Lines ending with '# TEMP':"
grep -E '\s*# TEMP$' "$file"

# Remove lines ending with '# TEMP' and save backup to /tmp
sed -i".bak" '/\s*# TEMP$/d' "$file"
mv "$file.bak" /tmp

echo "Backup of original file saved to: $bak_file"
echo "Run the following to check the differences:"
echo "  diff /tmp/$file.bak $file"
